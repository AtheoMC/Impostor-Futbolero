<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Impostor Futbolero</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 90%;
            width: 450px;
            background-color: #2a2a2a;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            padding: 3rem 2rem;
            text-align: center;
        }
        .title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #ffffff;
        }
        .form-input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.75rem;
            background-color: #333333;
            border: 2px solid #444444;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5);
        }
        .btn {
            width: 100%;
            padding: 1.25rem;
            border-radius: 0.75rem;
            font-weight: 600;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 1.125rem;
        }
        .btn-primary {
            background-color: #4f46e5;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #10b981;
        }
        .btn-secondary:hover {
            background-color: #059669;
        }
        .btn-join {
            background-color: #4f46e5;
        }
        .btn-join:hover {
            background-color: #4338ca;
        }
        .form-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .form-row .form-input {
            margin-bottom: 0;
        }
        .message-box {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            text-align: left;
            font-size: 0.875rem;
            display: none;
        }
        .message-info {
            background-color: #3b82f6;
            color: #eff6ff;
        }
        .message-error {
            background-color: #ef4444;
            color: #fee2e2;
        }
        .players-list {
            margin-top: 2rem;
            text-align: left;
        }
        .players-list h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .player-card {
            background-color: #333333;
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        .player-card img {
            border-radius: 50%;
        }
        .voting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        .vote-btn {
            padding: 0.75rem;
            border-radius: 0.75rem;
            background-color: #444444;
            color: #ffffff;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-align: center;
        }
        .vote-btn:hover {
            background-color: #555555;
        }
        .vote-btn.voted {
            background-color: #10b981;
        }
        .player-vote-count {
            color: #10b981;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <!-- The UI will be rendered here by JavaScript -->
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, updateDoc, arrayUnion, addDoc, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration (DO NOT CHANGE)
        const firebaseConfig = JSON.parse('{"projectId":"impostor-futbolero-online","appId":"1:1067586840575:web:32889c085f7cf461bfa9ca","apiKey":"AIzaSyCumowABsEKfX_js3s0KjdIGi0Oor6MXvA","authDomain":"impostor-futbolero-online.firebaseapp.com","storageBucket":"impostor-futbolero-online.firebasestorage.app"}');
        const __app_id = "el_impostor_futbolero";
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;
        let playerName = '';
        let roomId = '';
        let currentGameState = 'lobby';
        let playerRole = 'tripulante';
        let secretPlayerName = '';
        let isImpostor = false;
        let hasVoted = false;

        const MIN_PLAYERS = 3;

        // Lista de 150 jugadores de fútbol con un placeholder de imagen
        const footballPlayers = [
            { name: "Lionel Messi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Messi" },
            { name: "Cristiano Ronaldo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ronaldo" },
            { name: "Neymar Jr.", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Neymar" },
            { name: "Kylian Mbappé", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Mbappe" },
            { name: "Kevin De Bruyne", img: "https://placehold.co/200x200/4f46e5/ffffff?text=De+Bruyne" },
            { name: "Erling Haaland", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Haaland" },
            { name: "Robert Lewandowski", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lewandowski" },
            { name: "Karim Benzema", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Benzema" },
            { name: "Mohamed Salah", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Salah" },
            { name: "Luka Modrić", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Modric" },
            { name: "Harry Kane", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kane" },
            { name: "Sadio Mané", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Mane" },
            { name: "Virgil van Dijk", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Van+Dijk" },
            { name: "Alisson Becker", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alisson" },
            { name: "Thibaut Courtois", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Courtois" },
            { name: "Manuel Neuer", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Neuer" },
            { name: "Joshua Kimmich", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kimmich" },
            { name: "Toni Kroos", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kroos" },
            { name: "Vinícius Júnior", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vinicius" },
            { name: "Pedri", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pedri" },
            { name: "Gavi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gavi" },
            { name: "Ferran Torres", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Torres" },
            { name: "João Félix", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Felix" },
            { name: "Bernardo Silva", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Silva" },
            { name: "Bruno Fernandes", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Fernandes" },
            { name: "Phil Foden", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Foden" },
            { name: "Jack Grealish", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Grealish" },
            { name: "Marcus Rashford", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rashford" },
            { name: "Jadon Sancho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Sancho" },
            { name: "Declan Rice", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rice" },
            { name: "Jude Bellingham", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bellingham" },
            { name: "Bukayo Saka", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Saka" },
            { name: "Mason Mount", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Mount" },
            { name: "Kai Havertz", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Havertz" },
            { name: "Timo Werner", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Werner" },
            { name: "Serge Gnabry", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gnabry" },
            { name: "Leon Goretzka", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Goretzka" },
            { name: "Ilkay Gündoğan", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gundogan" },
            { name: "Leroy Sané", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Sane" },
            { name: "Ansu Fati", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ansu+Fati" },
            { name: "Ousmane Dembélé", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Dembele" },
            { name: "Frenkie de Jong", img: "https://placehold.co/200x200/4f46e5/ffffff?text=De+Jong" },
            { name: "Memphis Depay", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Depay" },
            { name: "Julián Álvarez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alvarez" },
            { name: "Lautaro Martínez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Martinez" },
            { name: "Paulo Dybala", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Dybala" },
            { name: "Ángel Di María", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Di+Maria" },
            { name: "N'Golo Kanté", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kante" },
            { name: "Paul Pogba", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pogba" },
            { name: "Antoine Griezmann", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Griezmann" },
            { name: "Olivier Giroud", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Giroud" },
            { name: "Romelu Lukaku", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lukaku" },
            { name: "Kevin Mbabu", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Mbabu" },
            { name: "Federico Chiesa", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Chiesa" },
            { name: "Marco Verratti", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Verratti" },
            { name: "Jorginho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Jorginho" },
            { name: "Alessandro Bastoni", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bastoni" },
            { name: "Gianluigi Donnarumma", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Donnarumma" },
            { name: "Koke", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Koke" },
            { name: "Álvaro Morata", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Morata" },
            { name: "David de Gea", img: "https://placehold.co/200x200/4f46e5/ffffff?text=De+Gea" },
            { name: "Jan Oblak", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Oblak" },
            { name: "Ederson", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ederson" },
            { name: "Casemiro", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Casemiro" },
            { name: "Eder Militão", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Militao" },
            { name: "Raphinha", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Raphinha" },
            { name: "Gabriel Jesus", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Jesus" },
            { name: "Richarlison", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Richarlison" },
            { name: "Dani Alves", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alves" },
            { name: "Marcelo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Marcelo" },
            { name: "Sergio Ramos", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ramos" },
            { name: "Gerard Piqué", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pique" },
            { name: "Ronald Araújo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Araujo" },
            { name: "Darwin Núñez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Nunez" },
            { name: "Luis Díaz", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Diaz" },
            { name: "Luis Suárez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Suarez" },
            { name: "Edinson Cavani", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Cavani" },
            { name: "Giorgio Chiellini", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Chiellini" },
            { name: "Leonardo Bonucci", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bonucci" },
            { name: "Lorenzo Insigne", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Insigne" },
            { name: "Ciro Immobile", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Immobile" },
            { name: "Dries Mertens", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Mertens" },
            { name: "Eden Hazard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Hazard" },
            { name: "Christian Eriksen", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Eriksen" },
            { name: "Heung-min Son", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Son" },
            { name: "Takefusa Kubo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kubo" },
            { name: "Shinji Kagawa", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kagawa" },
            { name: "Achraf Hakimi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Hakimi" },
            { name: "Zlatan Ibrahimović", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Zlatan" },
            { name: "Gareth Bale", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bale" },
            { name: "David Alaba", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alaba" },
            { name: "Dušan Vlahović", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vlahovic" },
            { name: "Kalidou Koulibaly", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Koulibaly" },
            { name: "André Onana", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Onana" },
            { name: "Salomón Rondón", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rondon" },
            { name: "Juan Arango", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Arango" },
            { name: "Yeferson Soteldo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Soteldo" },
            { name: "Diego Maradona", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Maradona" },
            { name: "Pelé", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pele" },
            { name: "Alfredo Di Stéfano", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Di+Stefano" },
            { name: "Johan Cruyff", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Cruyff" },
            { name: "Franz Beckenbauer", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Beckenbauer" },
            { name: "Marco van Basten", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Van+Basten" },
            { name: "George Best", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Best" },
            { name: "Michel Platini", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Platini" },
            { name: "Zinedine Zidane", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Zidane" },
            { name: "Ronaldo Nazário", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ronaldo" },
            { name: "Ronaldinho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ronaldinho" },
            { name: "Kaká", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kaka" },
            { name: "Thierry Henry", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Henry" },
            { name: "Dennis Bergkamp", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bergkamp" },
            { name: "Paolo Maldini", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Maldini" },
            { name: "Roberto Baggio", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Baggio" },
            { name: "Andrea Pirlo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pirlo" },
            { name: "Iker Casillas", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Casillas" },
            { name: "Xavi Hernández", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Xavi" },
            { name: "Andrés Iniesta", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Iniesta" },
            { name: "David Villa", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Villa" },
            { name: "Fernando Torres", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Torres" },
            { name: "Francesco Totti", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Totti" },
            { name: "Gigi Buffon", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Buffon" },
            { name: "Steven Gerrard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gerrard" },
            { name: "Frank Lampard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lampard" },
            { name: "Didier Drogba", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Drogba" },
            { name: "Arjen Robben", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Robben" },
            { name: "Wesley Sneijder", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Sneijder" },
            { name: "Robin van Persie", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Van+Persie" },
            { name: "Wayne Rooney", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rooney" },
            { name: "Carlos Tevez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Tevez" },
            { name: "Luis Figo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Figo" },
            { name: "Raúl González", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Raul" },
            { name: "Sergio Agüero", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Aguero" },
            { name: "Diego Forlán", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Forlan" },
            { name: "Alexis Sánchez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alexis" },
            { name: "Arturo Vidal", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vidal" },
            { name: "Claudio Bravo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bravo" },
            { name: "James Rodríguez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=James" },
            { name: "Radamel Falcao", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Falcao" },
            { name: "Keylor Navas", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Navas" },
            { name: "Hugo Lloris", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lloris" },
            { name: "Raphaël Varane", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Varane" },
            { name: "Mats Hummels", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Hummels" },
            { name: "Manuel Neuer", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Neuer" },
            { name: "Thomas Müller", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Muller" },
            { name: "Marco Reus", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Reus" },
            { name: "Mesut Özil", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ozil" },
            { name: "Mario Götze", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gotze" },
            { name: "Sami Khedira", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Khedira" },
            { name: "Miroslav Klose", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Klose" },
            { name: "Gigi Buffon", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Buffon" },
            { name: "Andrea Barzagli", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Barzagli" },
            { name: "Leonardo Bonucci", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bonucci" },
            { name: "Giorgio Chiellini", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Chiellini" },
            { name: "Dani Carvajal", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Carvajal" },
            { name: "Jordi Alba", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alba" },
            { name: "Dani Alves", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Alves" },
            { name: "Marcelo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Marcelo" },
            { name: "Nacho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Nacho" },
            { name: "Pepe", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pepe" },
            { name: "Gabriel Heinze", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Heinze" },
            { name: "Juan Román Riquelme", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Riquelme" },
            { name: "Ariel Ortega", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ortega" },
            { name: "Javier Saviola", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Saviola" },
            { name: "Hernán Crespo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Crespo" },
            { name: "Batistuta", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Batistuta" },
            { name: "Claudio Caniggia", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Caniggia" },
            { name: "Ronald Koeman", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Koeman" },
            { name: "Ruud Gullit", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gullit" },
            { name: "Frank Rijkaard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rijkaard" },
            { name: "Dennis Bergkamp", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Bergkamp" },
            { name: "Marc Overmars", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Overmars" },
            { name: "Clarence Seedorf", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Seedorf" },
            { name: "Edgar Davids", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Davids" },
            { name: "Michael Owen", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Owen" },
            { name: "Alan Shearer", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Shearer" },
            { name: "Rio Ferdinand", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ferdinand" },
            { name: "John Terry", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Terry" },
            { name: "Ashley Cole", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Cole" },
            { name: "Steven Gerrard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gerrard" },
            { name: "Frank Lampard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lampard" },
            { name: "Didier Drogba", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Drogba" },
            { name: "Samuel Eto'o", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Etoo" },
            { name: "Patrick Vieira", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vieira" },
            { name: "Michael Ballack", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ballack" },
            { name: "Philipp Lahm", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lahm" },
            { name: "Miroslav Klose", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Klose" },
            { name: "Lothar Matthäus", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Matthaus" },
            { name: "Karl-Heinz Rummenigge", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rummenigge" },
            { name: "Oliver Kahn", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kahn" },
            { name: "Toni Kroos", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kroos" },
            { name: "Luka Modrić", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Modric" },
            { name: "Ivan Rakitić", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rakitic" },
            { name: "Kevin De Bruyne", img: "https://placehold.co/200x200/4f46e5/ffffff?text=De+Bruyne" },
            { name: "Thibaut Courtois", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Courtois" },
            { name: "Eden Hazard", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Hazard" },
            { name: "Romelu Lukaku", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lukaku" },
            { name: "Jan Vertonghen", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vertonghen" },
            { name: "Christian Eriksen", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Eriksen" },
            { name: "Kasper Schmeichel", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Schmeichel" },
            { name: "Peter Schmeichel", img: "https://placehold.co/200x200/4f46e5/ffffff?text=P+Schmeichel" },
            { name: "Henrik Larsson", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Larsson" },
            { name: "Anders Svensson", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Svensson" },
            { name: "Sebastian Larsson", img: "https://placehold.co/200x200/4f46e5/ffffff?text=S+Larsson" },
            { name: "Nani", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Nani" },
            { name: "Ricardo Quaresma", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Quaresma" },
            { name: "João Moutinho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Moutinho" },
            { name: "Pepe", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pepe" },
            { name: "Renato Sanches", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Sanches" },
            { name: "Luis Figo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Figo" },
            { name: "Rui Costa", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rui+Costa" },
            { name: "Ricardo Carvalho", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Carvalho" },
            { name: "Deco", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Deco" },
            { name: "Fabio Cannavaro", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Cannavaro" },
            { name: "Alessandro Del Piero", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Del+Piero" },
            { name: "Filippo Inzaghi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Inzaghi" },
            { name: "Andrea Pirlo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pirlo" },
            { name: "Marco Materazzi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Materazzi" },
            { name: "Gennaro Gattuso", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Gattuso" },
            { name: "Andrea Barzagli", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Barzagli" },
            { name: "Daniele De Rossi", img: "https://placehold.co/200x200/4f46e5/ffffff?text=De+Rossi" },
            { name: "Luca Toni", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Toni" },
            { name: "Mario Balotelli", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Balotelli" },
            { name: "Thiago Silva", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Silva" },
            { name: "Neymar Jr.", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Neymar" },
            { name: "Gabriel Martinelli", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Martinelli" },
            { name: "Rodrygo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rodrygo" },
            { name: "Alphonso Davies", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Davies" },
            { name: "Christian Pulisic", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pulisic" },
            { name: "Giovanni Reyna", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Reyna" },
            { name: "Weston McKennie", img: "https://placehold.co/200x200/4f46e5/ffffff?text=McKennie" },
            { name: "Hirving Lozano", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Lozano" },
            { name: "Guillermo Ochoa", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ochoa" },
            { name: "Raúl Jiménez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Jimenez" },
            { name: "Alexis Vega", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vega" },
            { name: "Keylor Navas", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Navas" },
            { name: "Joel Campbell", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Campbell" },
            { name: "Brian Ruiz", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Ruiz" },
            { name: "Salomón Rondón", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Rondon" },
            { name: "Juan Arango", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Arango" },
            { name: "Yeferson Soteldo", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Soteldo" },
            { name: "Jefferson Farfán", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Farfan" },
            { name: "Paolo Guerrero", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Guerrero" },
            { name: "Claudio Pizarro", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Pizarro" },
            { name: "Arturo Vidal", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Vidal" },
            { name: "Alexis Sánchez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Sanchez" },
            { name: "Gary Medel", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Medel" },
            { name: "James Rodríguez", img: "https://placehold.co/200x200/4f46e5/ffffff?text=James" },
            { name: "Luis Díaz", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Diaz" },
            { name: "Radamel Falcao", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Falcao" },
            { name: "Alphonso Davies", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Davies" },
            { name: "Jonathan David", img: "https://placehold.co/200x200/4f46e5/ffffff?text=David" },
            { name: "Tajon Buchanan", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Buchanan" },
            { name: "Cyle Larin", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Larin" },
            { name: "Atiba Hutchinson", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Hutchinson" },
            { name: "Stephen Eustaquio", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Eustaquio" },
            { name: "Ismaël Koné", img: "https://placehold.co/200x200/4f46e5/ffffff?text=Kone" }
        ];

        // Renders the initial lobby UI
        const renderLobby = () => {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="message-box message-info" id="infoMessage"></div>
                <div class="message-box message-error" id="errorMessage"></div>
                <h1 class="title">Impostor Futbolero</h1>
                <input type="text" id="playerNameInput" placeholder="Introduce tu nombre" class="form-input">
                <button id="createRoomBtn" class="btn btn-primary">Crear Sala</button>
                <div class="form-row mt-4">
                    <input type="text" id="roomIdInput" placeholder="CÓDIGO DE SALA" class="form-input text-center uppercase">
                    <button id="joinRoomBtn" class="btn btn-secondary">Unirse</button>
                </div>
                <div id="playerList" class="players-list hidden">
                    <h2 class="text-xl font-semibold mt-6 mb-2">Jugadores en la sala:</h2>
                    <ul id="playersUl" class="list-disc pl-5 text-gray-400"></ul>
                    <p class="text-gray-500 mt-2 text-sm" id="playerRoomId"></p>
                </div>
            `;
            document.getElementById('createRoomBtn').addEventListener('click', createRoom);
            document.getElementById('joinRoomBtn').addEventListener('click', joinRoom);
        };

        // Renders the waiting room UI
        const renderWaiting = (roomId, players) => {
            const app = document.getElementById('app');
            app.innerHTML = `
                <h1 class="title">Sala: ${roomId}</h1>
                <p class="text-gray-400 mb-6">Esperando a más jugadores...</p>
                <p class="text-sm text-gray-500 mb-6">Necesitas ${MIN_PLAYERS} jugadores para empezar.</p>
                <div id="playerList" class="players-list">
                    <h2 class="text-xl font-semibold mb-2">Jugadores en la sala:</h2>
                    <ul id="playersUl" class="list-disc pl-5">
                        ${players.map(player => `<li class="text-gray-400">${player.name}</li>`).join('')}
                    </ul>
                </div>
                ${players.length >= MIN_PLAYERS ? `<button id="startGameBtn" class="btn btn-primary mt-6">Empezar Juego</button>` : `<p class="mt-6 text-gray-500">Esperando jugadores...</p>`}
            `;
            if (players.length >= MIN_PLAYERS) {
                document.getElementById('startGameBtn').addEventListener('click', startGame);
            }
        };

        // Renders the game UI
        const renderGameUI = (players, isImpostor, secretPlayer) => {
            const app = document.getElementById('app');
            let content = '';

            if (isImpostor) {
                content = `
                    <h1 class="title text-red-500">¡Eres el Impostor!</h1>
                    <p class="text-lg text-gray-300 mb-4">Tu misión es no ser descubierto.</p>
                    <p class="text-sm text-gray-500 mb-4">Usa tus preguntas para confundir a los tripulantes.</p>
                `;
            } else {
                content = `
                    <h1 class="title text-green-500">¡Eres Tripulante!</h1>
                    <p class="text-lg text-gray-300 mb-4">El jugador es:</p>
                    <div class="player-card">
                        <img src="${secretPlayer.img}" alt="${secretPlayer.name}" class="w-32 h-32 object-cover">
                        <h2 class="text-2xl font-bold mt-2">${secretPlayer.name}</h2>
                    </div>
                `;
            }

            // Players list below the game info
            content += `
                <div id="playerList" class="players-list">
                    <h2 class="text-xl font-semibold mt-6 mb-2">Jugadores:</h2>
                    <div class="voting-grid">
                        ${players.map(player => `
                            <button id="voteBtn-${player.id}" data-player-id="${player.id}" class="vote-btn flex flex-col items-center">
                                <img src="${player.role === 'impostor' ? 'https://placehold.co/64x64/ef4444/ffffff?text=I' : 'https://placehold.co/64x64/10b981/ffffff?text=T'}" alt="${player.name}" class="w-16 h-16 rounded-full mb-2">
                                <span class="text-sm">${player.name}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
                <button id="endGameBtn" class="btn btn-secondary mt-6">Iniciar Votación</button>
            `;

            app.innerHTML = content;

            document.getElementById('endGameBtn').addEventListener('click', startVoting);
        };

        // Renders the voting UI
        const renderVoting = (players) => {
            const app = document.getElementById('app');
            app.innerHTML = `
                <h1 class="title">¡Hora de votar!</h1>
                <p class="text-lg text-gray-300 mb-6">¿Quién es el impostor?</p>
                <div class="voting-grid">
                    ${players.map(player => `
                        <button data-player-id="${player.id}" class="vote-btn ${hasVoted ? 'voted' : ''}">
                            <img src="https://placehold.co/64x64/4f46e5/ffffff?text=Voto" alt="${player.name}" class="w-16 h-16 rounded-full mb-2">
                            <span class="text-sm">${player.name}</span>
                            <div class="player-vote-count" id="votes-${player.id}"></div>
                        </button>
                    `).join('')}
                </div>
            `;

            document.querySelectorAll('.vote-btn').forEach(button => {
                if (!hasVoted) {
                    button.addEventListener('click', (e) => {
                        const votedPlayerId = e.currentTarget.dataset.playerId;
                        submitVote(votedPlayerId);
                    });
                }
            });
        };

        // Renders the final result UI
        const renderResult = (message, isWinner) => {
            const app = document.getElementById('app');
            const messageClass = isWinner ? 'bg-green-600' : 'bg-red-600';
            app.innerHTML = `
                <div class="message-box ${messageClass} block">
                    <h1 class="text-2xl font-bold">${isWinner ? '¡Victoria!' : '¡Derrota!'}</h1>
                    <p class="mt-2 text-sm">${message}</p>
                </div>
                <button id="playAgainBtn" class="btn btn-primary mt-6">Jugar de nuevo</button>
            `;
            document.getElementById('playAgainBtn').addEventListener('click', resetGame);
        };

        // Function to create a room
        const createRoom = async () => {
            const nameInput = document.getElementById('playerNameInput');
            if (!nameInput.value) return showMessage('Por favor, introduce tu nombre.', 'error');

            playerName = nameInput.value;
            roomId = Math.random().toString(36).substring(2, 7).toUpperCase();

            try {
                const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
                const playersRef = collection(roomRef, 'players');

                await setDoc(roomRef, { status: 'waiting', players: [] });
                
                await addDoc(playersRef, {
                    name: playerName,
                    id: userId,
                    status: 'online',
                    role: 'tripulante',
                    votes: 0
                });

                startRoomListener();
                showMessage(`Sala creada. ID: ${roomId}`, 'info');
            } catch (error) {
                console.error("Error al crear la sala: ", error);
                showMessage("Error al crear la sala. Intenta de nuevo.", 'error');
            }
        };

        // Function to join a room
        const joinRoom = async () => {
            const nameInput = document.getElementById('playerNameInput');
            const idInput = document.getElementById('roomIdInput');
            if (!nameInput.value || !idInput.value) return showMessage('Por favor, introduce tu nombre y el ID de la sala.', 'error');

            playerName = nameInput.value;
            roomId = idInput.value.toUpperCase();

            try {
                const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
                const roomSnap = await getDoc(roomRef);

                if (!roomSnap.exists()) {
                    return showMessage('La sala no existe.', 'error');
                }

                const playersRef = collection(roomRef, 'players');
                const playersSnapshot = await getDocs(playersRef);
                const existingPlayers = playersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                const isAlreadyJoined = existingPlayers.some(player => player.id === userId);
                if (isAlreadyJoined) {
                    showMessage('Ya estás en esta sala.', 'error');
                    startRoomListener();
                    return;
                }

                await addDoc(playersRef, {
                    name: playerName,
                    id: userId,
                    status: 'online',
                    role: 'tripulante',
                    votes: 0
                });

                startRoomListener();
                showMessage(`Te has unido a la sala ${roomId}.`, 'info');
            } catch (error) {
                console.error("Error al unirse a la sala: ", error);
                showMessage("Error al unirse a la sala. Intenta de nuevo.", 'error');
            }
        };

        // Listen for real-time changes in the room
        const startRoomListener = () => {
            const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
            onSnapshot(roomRef, async (docSnap) => {
                if (!docSnap.exists()) {
                    showMessage('La sala fue eliminada.', 'info');
                    resetGame();
                    return renderLobby();
                }

                const roomData = docSnap.data();
                currentGameState = roomData.status;

                const playersRef = collection(roomRef, 'players');
                onSnapshot(playersRef, (snapshot) => {
                    const players = snapshot.docs.map(doc => ({ docId: doc.id, ...doc.data() }));
                    const currentPlayer = players.find(p => p.id === userId);
                    if (currentPlayer) {
                        playerRole = currentPlayer.role;
                    }

                    if (currentGameState === 'waiting') {
                        renderWaiting(roomId, players);
                    } else if (currentGameState === 'playing') {
                        secretPlayerName = roomData.secretPlayerName;
                        isImpostor = (playerRole === 'impostor');
                        const secretPlayer = footballPlayers.find(p => p.name === secretPlayerName);
                        renderGameUI(players, isImpostor, secretPlayer);
                    } else if (currentGameState === 'voting') {
                        renderVoting(players);
                        updateVoteCounts(players);
                    } else if (currentGameState === 'results') {
                        const winner = roomData.winner;
                        const eliminatedPlayerName = roomData.eliminatedPlayerName;
                        const message = winner === 'tripulante'
                            ? `¡La tripulación ha ganado! El impostor ha sido eliminado: ${eliminatedPlayerName}.`
                            : `¡El impostor ha ganado! No lo adivinaron.`;
                        renderResult(message, winner === playerRole);
                    }
                });
            });
        };

        // Start the game
        const startGame = async () => {
            const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
            const playersRef = collection(roomRef, 'players');
            const playersSnapshot = await getDocs(playersRef);
            const players = playersSnapshot.docs.map(doc => ({ docId: doc.id, ...doc.data() }));

            if (players.length < MIN_PLAYERS) {
                showMessage(`Necesitas al menos ${MIN_PLAYERS} jugadores para empezar.`, 'error');
                return;
            }

            const impostor = players[Math.floor(Math.random() * players.length)];
            const secretPlayer = footballPlayers[Math.floor(Math.random() * footballPlayers.length)];

            await updateDoc(roomRef, {
                status: 'playing',
                secretPlayerName: secretPlayer.name
            });

            await Promise.all(players.map(player => {
                const role = player.docId === impostor.docId ? 'impostor' : 'tripulante';
                return updateDoc(doc(playersRef, player.docId), { role: role });
            }));
        };
        
        // Start voting phase
        const startVoting = async () => {
            const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
            await updateDoc(roomRef, { status: 'voting' });
        };

        // Submit a vote
        const submitVote = async (votedPlayerId) => {
            if (hasVoted) {
                showMessage('Ya has votado.', 'error');
                return;
            }

            const playersRef = collection(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId, 'players');
            const playerDocRef = doc(playersRef, playersRef.docs.find(d => d.data().id === votedPlayerId).docId);
            await updateDoc(playerDocRef, { votes: arrayUnion(userId) });

            hasVoted = true;
            showMessage('Voto registrado.', 'info');
        };

        // Update vote counts
        const updateVoteCounts = (players) => {
            const voteCounts = {};
            players.forEach(player => {
                const votedFor = player.votes;
                if (votedFor) {
                    votedFor.forEach(votedId => {
                        voteCounts[votedId] = (voteCounts[votedId] || 0) + 1;
                    });
                }
            });

            players.forEach(player => {
                const voteCountElement = document.getElementById(`votes-${player.id}`);
                if (voteCountElement) {
                    voteCountElement.textContent = `Votos: ${voteCounts[player.id] || 0}`;
                }
            });

            const totalVotes = players.reduce((sum, player) => sum + (player.votes ? player.votes.length : 0), 0);
            if (totalVotes === players.length) {
                resolveVote(players, voteCounts);
            }
        };

        // Resolve the vote and determine the winner
        const resolveVote = async (players, voteCounts) => {
            let maxVotes = 0;
            let tiedPlayers = [];
            for (const playerId in voteCounts) {
                if (voteCounts[playerId] > maxVotes) {
                    maxVotes = voteCounts[playerId];
                    tiedPlayers = [playerId];
                } else if (voteCounts[playerId] === maxVotes) {
                    tiedPlayers.push(playerId);
                }
            }

            const eliminatedPlayerId = tiedPlayers[Math.floor(Math.random() * tiedPlayers.length)];
            const eliminatedPlayer = players.find(p => p.id === eliminatedPlayerId);

            const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);

            if (eliminatedPlayer.role === 'impostor') {
                await updateDoc(roomRef, {
                    status: 'results',
                    winner: 'tripulante',
                    eliminatedPlayerName: eliminatedPlayer.name
                });
            } else {
                const remainingPlayers = players.filter(p => p.id !== eliminatedPlayerId);
                const remainingImpostors = remainingPlayers.filter(p => p.role === 'impostor').length;

                if (remainingImpostors === 0 || remainingImpostors >= remainingPlayers.length - remainingImpostors) {
                    await updateDoc(roomRef, {
                        status: 'results',
                        winner: 'impostor',
                        eliminatedPlayerName: eliminatedPlayer.name
                    });
                } else {
                    await Promise.all(players.map(player => updateDoc(doc(collection(roomRef, 'players'), player.docId), { votes: [] })));
                    await updateDoc(roomRef, { status: 'playing' });
                }
            }
        };

        // Show a message to the user
        const showMessage = (message, type) => {
            const messageBox = document.getElementById(type === 'error' ? 'errorMessage' : 'infoMessage');
            if (messageBox) {
                messageBox.textContent = message;
                messageBox.style.display = 'block';
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 5000);
            }
        };

        // Reset the game and clean up data
        const resetGame = async () => {
            if (roomId) {
                const roomRef = doc(db, 'artifacts', __app_id, 'public', 'data', 'rooms', roomId);
                const playersRef = collection(roomRef, 'players');
                const playersSnapshot = await getDocs(playersRef);
                playersSnapshot.forEach(async (playerDoc) => {
                    await deleteDoc(doc(playersRef, playerDoc.id));
                });
                await deleteDoc(roomRef);
            }
            userId = null;
            playerName = '';
            roomId = '';
            currentGameState = 'lobby';
            playerRole = 'tripulante';
            secretPlayerName = '';
            isImpostor = false;
            hasVoted = false;
            renderLobby();
        };

        // Initialize the app on window load
        window.onload = async () => {
            const userIdFromAuth = auth.currentUser?.uid || crypto.randomUUID();
            userId = userIdFromAuth;
            await signInAnonymously(auth);
            renderLobby();
        };
    </script>
</body>
</html>
